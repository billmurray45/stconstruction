{% extends "admin/base.html" %}

{% block title %}Управление пользователями{% endblock %}

{% block active_users %}active{% endblock %}

{% block breadcrumb %}
<a href="/admin/">Главная</a> › Пользователи
{% endblock %}

{% block extra_styles %}
/* USERS LIST ADMIN CSS */
.page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px}
.page-title{font-size:28px;color:#333;font-weight:400}
.btn-add{padding:10px 20px;background:#417690;color:#fff;border:none;border-radius:4px;text-decoration:none;font-size:14px;transition:all .2s ease;display:inline-flex;align-items:center;gap:8px}
.btn-add:hover{background:#2e5a6e}
.alert{padding:12px 16px;border-radius:4px;margin-bottom:20px;font-size:14px}
.alert-success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
.alert-error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
.users-table-wrapper{background:#fff;border:1px solid #ddd;border-radius:4px;overflow:hidden}
.users-table{width:100%;border-collapse:collapse}
.users-table thead{background:#f8f8f8;border-bottom:2px solid #ddd}
.users-table th{padding:12px 15px;text-align:left;font-size:13px;font-weight:600;color:#666;text-transform:uppercase;letter-spacing:.5px}
.users-table td{padding:12px 15px;border-bottom:1px solid #eee;font-size:14px;color:#333}
.users-table tbody tr:hover{background:#f8f8f8}
.status-badge{padding:4px 12px;border-radius:12px;font-size:12px;font-weight:500}
.status-superuser{background:#d4edda;color:#155724}
.status-regular{background:#e2e3e5;color:#383d41}
.action-buttons{display:flex;gap:8px}
.btn-icon{padding:6px 10px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer;transition:all .2s ease;color:#417690;text-decoration:none;font-size:14px}
.btn-icon:hover{background:#417690;color:#fff;border-color:#417690}
.btn-icon.delete{color:#dc3545}
.btn-icon.delete:hover{background:#dc3545;color:#fff;border-color:#dc3545}
.empty-state{padding:60px 20px;text-align:center;color:#999}
.empty-state i{font-size:48px;margin-bottom:20px;color:#ddd}
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Управление пользователями</h1>
    <a href="/admin/users/add" class="btn-add">
        <i class="fas fa-plus"></i>
        Добавить пользователя
    </a>
</div>

<!-- Success/Error messages -->
{% if request.query_params.get('success') == 'created' %}
<div class="alert alert-success">
    <i class="fas fa-check-circle"></i> Пользователь успешно создан!
</div>
{% elif request.query_params.get('success') == 'updated' %}
<div class="alert alert-success">
    <i class="fas fa-check-circle"></i> Пользователь успешно обновлен!
</div>
{% elif request.query_params.get('success') == 'deleted' %}
<div class="alert alert-success">
    <i class="fas fa-check-circle"></i> Пользователь успешно удален!
</div>
{% elif request.query_params.get('error') %}
<div class="alert alert-error">
    <i class="fas fa-exclamation-circle"></i> Произошла ошибка при выполнении операции.
</div>
{% endif %}

<!-- Users Table -->
{% if users %}
<div class="users-table-wrapper">
    <table class="users-table">
        <thead>
            <tr>
                <th style="width: 80px;">ID</th>
                <th>Email</th>
                <th>Имя</th>
                <th style="width: 150px;">Роль</th>
                <th style="width: 180px;">Дата регистрации</th>
                <th style="width: 150px;">Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.id }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.full_name or '—' }}</td>
                <td>
                    {% if user.is_superuser %}
                    <span class="status-badge status-superuser">
                        Администратор
                    </span>
                    {% else %}
                    <span class="status-badge status-regular">
                        Пользователь
                    </span>
                    {% endif %}
                </td>
                <td>{{ user.created_at.strftime('%d.%m.%Y %H:%M') if user.created_at else '—' }}</td>
                <td>
                    <div class="action-buttons">
                        <a href="/admin/users/{{ user.id }}/edit" class="btn-icon" title="Редактировать">
                            <i class="fas fa-edit"></i>
                        </a>
                        {% if user.id != current_user.id %}
                        <form method="post" action="/admin/users/{{ user.id }}/delete" style="display: inline;"
                              onsubmit="return confirm('Вы уверены, что хотите удалить этого пользователя?')">
                            <button type="submit" class="btn-icon delete" title="Удалить">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="users-table-wrapper">
    <div class="empty-state">
        <i class="fas fa-users"></i>
        <h3>Пользователей пока нет</h3>
        <p>В системе еще не зарегистрировано ни одного пользователя</p>
    </div>
</div>
{% endif %}
{% endblock %}
