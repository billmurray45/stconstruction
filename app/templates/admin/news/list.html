{% extends "admin/base.html" %}

{% block title %}Управление новостями{% endblock %}

{% block active_news %}active{% endblock %}

{% block breadcrumb %}
<a href="/admin/">Главная</a> › Новости
{% endblock %}

{% block extra_styles %}
/* NEWS LIST ADMIN CSS */
.page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px}
.page-title{font-size:28px;color:#333;font-weight:400}
.btn-add{padding:10px 20px;background:#417690;color:#fff;border:none;border-radius:4px;text-decoration:none;font-size:14px;transition:all .2s ease;display:inline-flex;align-items:center;gap:8px}
.btn-add:hover{background:#2e5a6e}
.alert{padding:12px 16px;border-radius:4px;margin-bottom:20px;font-size:14px}
.alert-success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
.alert-error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
.news-table-wrapper{background:#fff;border:1px solid #ddd;border-radius:4px;overflow:hidden}
.news-table{width:100%;border-collapse:collapse}
.news-table thead{background:#f8f8f8;border-bottom:2px solid #ddd}
.news-table th{padding:12px 15px;text-align:left;font-size:13px;font-weight:600;color:#666;text-transform:uppercase;letter-spacing:.5px}
.news-table td{padding:12px 15px;border-bottom:1px solid #eee;font-size:14px;color:#333}
.news-table tbody tr:hover{background:#f8f8f8}
.news-image-thumb{width:60px;height:40px;object-fit:cover;border-radius:4px}
.status-badge{padding:4px 12px;border-radius:12px;font-size:12px;font-weight:500}
.status-published{background:#d4edda;color:#155724}
.status-draft{background:#fff3cd;color:#856404}
.action-buttons{display:flex;gap:8px}
.btn-icon{padding:6px 10px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer;transition:all .2s ease;color:#417690;text-decoration:none;font-size:14px}
.btn-icon:hover{background:#417690;color:#fff;border-color:#417690}
.btn-icon.delete{color:#dc3545}
.btn-icon.delete:hover{background:#dc3545;color:#fff;border-color:#dc3545}
.empty-state{padding:60px 20px;text-align:center;color:#999}
.empty-state i{font-size:48px;margin-bottom:20px;color:#ddd}
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Управление новостями</h1>
    <a href="/admin/news/add" class="btn-add">
        <i class="fas fa-plus"></i>
        Добавить новость
    </a>
</div>

<!-- Success/Error messages -->
{% if request.query_params.get('success') == 'created' %}
<div class="alert alert-success">
    <i class="fas fa-check-circle"></i> Новость успешно создана!
</div>
{% elif request.query_params.get('success') == 'updated' %}
<div class="alert alert-success">
    <i class="fas fa-check-circle"></i> Новость успешно обновлена!
</div>
{% elif request.query_params.get('success') == 'deleted' %}
<div class="alert alert-success">
    <i class="fas fa-check-circle"></i> Новость успешно удалена!
</div>
{% elif request.query_params.get('error') %}
<div class="alert alert-error">
    <i class="fas fa-exclamation-circle"></i> Произошла ошибка при выполнении операции.
</div>
{% endif %}

<!-- News Table -->
{% if news_list %}
<div class="news-table-wrapper">
    <table class="news-table">
        <thead>
            <tr>
                <th style="width: 80px;">ID</th>
                <th style="width: 100px;">Изображение</th>
                <th>Заголовок</th>
                <th style="width: 150px;">Slug</th>
                <th style="width: 120px;">Статус</th>
                <th style="width: 150px;">Дата публикации</th>
                <th style="width: 150px;">Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for news in news_list %}
            <tr>
                <td>{{ news.id }}</td>
                <td>
                    <img src="/static/{{ news.image_path }}" alt="{{ news.title }}" class="news-image-thumb">
                </td>
                <td>{{ news.title }}</td>
                <td><code>{{ news.slug }}</code></td>
                <td>
                    {% if news.is_published %}
                    <span class="status-badge status-published">
                        <i class="fas fa-check"></i>
                    </span>
                    {% else %}
                    <span class="status-badge status-draft">
                        <i class="fas fa-clock"></i>
                    </span>
                    {% endif %}
                </td>
                <td>{{ news.published_at.strftime('%d.%m.%Y %H:%M') }}</td>
                <td>
                    <div class="action-buttons">
                        <a href="/news/{{ news.slug }}" class="btn-icon" target="_blank" title="Просмотр">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="/admin/news/{{ news.id }}/edit" class="btn-icon" title="Редактировать">
                            <i class="fas fa-edit"></i>
                        </a>
                        <form method="post" action="/admin/news/{{ news.id }}/delete" style="display: inline;"
                              onsubmit="return confirm('Вы уверены, что хотите удалить эту новость?')">
                            <button type="submit" class="btn-icon delete" title="Удалить">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="news-table-wrapper">
    <div class="empty-state">
        <i class="fas fa-newspaper"></i>
        <h3>Новостей пока нет</h3>
        <p>Нажмите "Добавить новость" чтобы создать первую новость</p>
    </div>
</div>
{% endif %}
{% endblock %}
