{% extends "admin/base.html" %}

{% block title %}Управление проектами{% endblock %}

{% block active_projects %}active{% endblock %}

{% block breadcrumb %}
<a href="/admin/">Главная</a> › Проекты
{% endblock %}

{% block extra_styles %}
/* PROJECTS LIST ADMIN CSS */
.page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px}
.page-title{font-size:28px;color:#333;font-weight:400}
.btn-add{padding:10px 20px;background:#417690;color:#fff;border:none;border-radius:4px;text-decoration:none;font-size:14px;transition:all .2s ease;display:inline-flex;align-items:center;gap:8px}
.btn-add:hover{background:#2e5a6e}
.alert{padding:12px 16px;border-radius:4px;margin-bottom:20px;font-size:14px}
.alert-success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
.alert-error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
.projects-table-wrapper{background:#fff;border:1px solid #ddd;border-radius:4px;overflow:hidden}
.projects-table{width:100%;border-collapse:collapse}
.projects-table thead{background:#f8f8f8;border-bottom:2px solid #ddd}
.projects-table th{padding:12px 15px;text-align:left;font-size:13px;font-weight:600;color:#666;text-transform:uppercase;letter-spacing:.5px}
.projects-table td{padding:12px 15px;border-bottom:1px solid #eee;font-size:14px;color:#333}
.projects-table tbody tr:hover{background:#f8f8f8}
.status-badge{padding:4px 12px;border-radius:12px;font-size:12px;font-weight:500}
.status-published{background:#d4edda;color:#155724}
.status-draft{background:#fff3cd;color:#856404}
.class-badge{padding:4px 10px;border-radius:8px;font-size:11px;font-weight:600;text-transform:uppercase}
.class-comfort{background:#e3f2fd;color:#1976d2}
.class-premium{background:#f3e5f5;color:#7b1fa2}
.class-business{background:#fff3e0;color:#f57c00}
.action-buttons{display:flex;gap:8px}
.btn-icon{padding:6px 10px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer;transition:all .2s ease;color:#417690;text-decoration:none;font-size:14px}
.btn-icon:hover{background:#417690;color:#fff;border-color:#417690}
.btn-icon.delete{color:#dc3545}
.btn-icon.delete:hover{background:#dc3545;color:#fff;border-color:#dc3545}
.btn-icon.publish{color:#28a745}
.btn-icon.publish:hover{background:#28a745;color:#fff;border-color:#28a745}
.empty-state{padding:60px 20px;text-align:center;color:#999}
.empty-state i{font-size:48px;margin-bottom:20px;color:#ddd}
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Управление проектами</h1>
    <a href="/admin/projects/add" class="btn-add">
        <i class="fas fa-plus"></i>
        Добавить проект
    </a>
</div>

<!-- Success/Error messages -->
{% if request.query_params.get('success') == 'created' %}
<div class="alert alert-success">
    <i class="fas fa-check-circle"></i> Проект успешно создан!
</div>
{% elif request.query_params.get('success') == 'updated' %}
<div class="alert alert-success">
    <i class="fas fa-check-circle"></i> Проект успешно обновлен!
</div>
{% elif request.query_params.get('success') == 'deleted' %}
<div class="alert alert-success">
    <i class="fas fa-check-circle"></i> Проект успешно удален!
</div>
{% elif request.query_params.get('success') == 'toggled' %}
<div class="alert alert-success">
    <i class="fas fa-check-circle"></i> Статус публикации изменен!
</div>
{% elif request.query_params.get('error') %}
<div class="alert alert-error">
    <i class="fas fa-exclamation-circle"></i> {{ request.query_params.get('error') }}
</div>
{% endif %}

<!-- Projects Table -->
{% if projects %}
<div class="projects-table-wrapper">
    <table class="projects-table">
        <thead>
            <tr>
                <th style="width: 60px;">ID</th>
                <th>Название</th>
                <th style="width: 150px;">Город</th>
                <th style="width: 100px;">Класс</th>
                <th style="width: 100px;">Статус</th>
                <th style="width: 120px;">Публикация</th>
                <th style="width: 200px;">Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for project in projects %}
            <tr>
                <td>{{ project.id }}</td>
                <td>
                    <strong>{{ project.title }}</strong>
                    {% if project.subtitle %}
                    <div style="font-size:12px;color:#666;margin-top:4px">{{ project.subtitle }}</div>
                    {% endif %}
                </td>
                <td>{{ project.city.name if project.city else '—' }}</td>
                <td>
                    {% if project.project_class.value == 'comfort' %}
                    <span class="class-badge class-comfort">Комфорт</span>
                    {% elif project.project_class.value == 'premium' %}
                    <span class="class-badge class-premium">Премиум</span>
                    {% elif project.project_class.value == 'business' %}
                    <span class="class-badge class-business">Бизнес</span>
                    {% endif %}
                </td>
                <td>
                    {% if project.status.value == 'current' %}
                    Текущий
                    {% elif project.status.value == 'completed' %}
                    Завершен
                    {% elif project.status.value == 'planned' %}
                    Планируемый
                    {% endif %}
                </td>
                <td>
                    {% if project.is_published %}
                    <span class="status-badge status-published">
                        Опубликован
                    </span>
                    {% else %}
                    <span class="status-badge status-draft">
                        Черновик
                    </span>
                    {% endif %}
                </td>
                <td>
                    <div class="action-buttons">
                        <a href="/admin/projects/{{ project.id }}/edit" class="btn-icon" title="Редактировать">
                            <i class="fas fa-edit"></i>
                        </a>
                        <form method="post" action="/admin/projects/{{ project.id }}/toggle-publish" style="display: inline;">
                            <button type="submit" class="btn-icon publish" title="{% if project.is_published %}Снять с публикации{% else %}Опубликовать{% endif %}">
                                <i class="fas {% if project.is_published %}fa-eye-slash{% else %}fa-eye{% endif %}"></i>
                            </button>
                        </form>
                        <form method="post" action="/admin/projects/{{ project.id }}/delete" style="display: inline;"
                              onsubmit="return confirm('Вы уверены, что хотите удалить этот проект?')">
                            <button type="submit" class="btn-icon delete" title="Удалить">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="projects-table-wrapper">
    <div class="empty-state">
        <i class="fas fa-building"></i>
        <h3>Проектов пока нет</h3>
        <p>В системе еще не добавлено ни одного проекта</p>
    </div>
</div>
{% endif %}
{% endblock %}
